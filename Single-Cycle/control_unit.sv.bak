module control_unit (
    input  wire [6:0] opcode,
    input  wire [2:0] funct3,
    input  wire [6:0] funct7,
    
    output reg  [3:0] ALU_op,
    output reg        ALU_src,
    output reg        reg_write,
    output reg        mem_to_reg,
    output reg        mem_write,
    output reg        branch,
    output reg        jump,
    output reg  [2:0] branch_type
);

    always @(*) begin
        ALU_op      = 4'b0000;
        ALU_src     = 1'b0;
        reg_write   = 1'b0;
        mem_to_reg  = 1'b0;
        mem_write   = 1'b0;
        branch      = 1'b0;
        jump        = 1'b0;
        branch_type = 3'b000;
        
        case (opcode)
            7'b0110011: begin
                ALU_src   = 1'b0;
                reg_write = 1'b1;
                
                case ({funct7, funct3})
                    10'b0000000_000: ALU_op = 4'b0010; // ADD
                    10'b0100000_000: ALU_op = 4'b0110; // SUB
                    10'b0000000_111: ALU_op = 4'b0000; // AND
                    10'b0000000_110: ALU_op = 4'b0001; // OR
                    10'b0000000_100: ALU_op = 4'b0011; // XOR 
                    10'b0000000_010: ALU_op = 4'b0111; // SLT
                    default:         ALU_op = 4'b0000; // NOP
                endcase
            end
            
            7'b0010011: begin
                ALU_src   = 1'b1;
                reg_write = 1'b1;
                
                case (funct3)
                    3'b000: ALU_op = 4'b0010;
                    3'b100: ALU_op = 4'b0011;
                    3'b110: ALU_op = 4'b0001;
                    3'b111: ALU_op = 4'b0000;
                    3'b001: ALU_op = 4'b1000;
                    3'b101: begin
                        if (funct7 == 7'b0000000)
                            ALU_op = 4'b1001;
                        else if (funct7 == 7'b0100000)
                            ALU_op = 4'b1010;
                        else
                            ALU_op = 4'b0000;
                    end
                    3'b010: ALU_op = 4'b0111;
                    3'b011: ALU_op = 4'b1011;
                    default: ALU_op = 4'b0000;
                endcase
            end
            
            7'b0000011: begin
                ALU_src    = 1'b1;
                ALU_op     = 4'b0010;
                reg_write  = 1'b1;
                mem_to_reg = 1'b1;
            end
            
            7'b0100011: begin
                ALU_src    = 1'b1;
                ALU_op     = 4'b0010;
                reg_write  = 1'b0;
                mem_write  = 1'b1;
                mem_to_reg = 1'b0;
            end
            
            7'b1100011: begin
                ALU_src     = 1'b0;
                ALU_op      = 4'b0110;
                reg_write   = 1'b0;
                branch      = 1'b1;
                branch_type = funct3;
            end
            
            7'b0110111: begin
                ALU_src   = 1'b1;
                ALU_op    = 4'b1100;
                reg_write = 1'b1;
            end
            
            7'b0010111: begin
                ALU_src   = 1'b1;
                ALU_op    = 4'b1101;
                reg_write = 1'b1;
            end
            
            7'b1101111: begin
                ALU_src   = 1'b1;
                ALU_op    = 4'b0010;
                reg_write = 1'b1;
                jump      = 1'b1;
            end
            
            7'b1100111: begin
                ALU_src   = 1'b1;
                ALU_op    = 4'b0010;
                reg_write = 1'b1;
                jump      = 1'b1;
            end
            
            default: begin
            end
        endcase
    end

endmodule